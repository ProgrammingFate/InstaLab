{% extends "core/base.html" %}
{% load static %}

{% block title %}Perfil - {{ user.nickname }}{% endblock %}

{% block body_class %}profile-page{% endblock %}

{% block content %}
<div class="container">
    <div class="profile-card">
        <!-- Banner do Perfil -->
        <div class="profile-banner" id="profile-banner">
            <!-- Picker de Cores -->
            <div class="color-picker-container">
                <div class="color-option gradient1" onclick="changeBannerColor('gradient1')"></div>
                <div class="color-option gradient2" onclick="changeBannerColor('gradient2')"></div>
                <div class="color-option gradient3" onclick="changeBannerColor('gradient3')"></div>
                <div class="color-option gradient4" onclick="changeBannerColor('gradient4')"></div>
                <div class="color-option gradient5" onclick="changeBannerColor('gradient5')"></div>
            </div>
            
            <!-- Container do Avatar -->
            <div class="profile-avatar-container">
                <div class="profile-avatar">
                    {% if user.profile_picture %}
                        <img src="{{ user.profile_picture.url }}" alt="{{ user.nickname }}">
                    {% else %}
                        {{ user.nickname.0|upper }}
                    {% endif %}
                </div>
                <div class="profile-status"></div>
            </div>
        </div>

        <!-- Conteúdo do Perfil -->
        <div class="profile-content">
            <div class="profile-header">
                <div class="profile-info">
                    <h1 class="profile-name">
                        {{ user.nickname }}
                        {% if user.is_student %}
                            <span class="profile-badge">Estudante</span>
                        {% elif user.is_company %}
                            <span class="profile-badge">Empresa</span>
                        {% endif %}
                    </h1>
                    
                    {% if user.is_student %}
                        <p class="profile-subtitle">
                            {{ user.course|default:"Curso não informado" }} • {{ user.university|default:"Universidade não informada" }}
                        </p>
                    {% elif user.is_company %}
                        <p class="profile-subtitle">
                            {{ user.company_description|default:"Empresa Junior" }}
                        </p>
                    {% endif %}
                    
                    <div class="profile-meta">
                        <div class="meta-item">
                            <i class="fas fa-envelope"></i>
                            {{ user.email }}
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-calendar"></i>
                            Desde {{ user.date_joined|date:"M/Y" }}
                        </div>
                    </div>
                </div>

                <div class="profile-actions">
                    <a href="{% url 'core:home' %}" class="btn btn-outline">
                        <i class="fas fa-arrow-left"></i>
                        Voltar
                    </a>
                    <a href="{% url 'accounts:edit_profile' %}" class="btn btn-primary">
                        <i class="fas fa-edit"></i>
                        Editar Perfil
                    </a>
                    {% if user.is_company %}
                        <a href="{% url 'core:create_job' %}" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            Nova Vaga
                        </a>
                    {% endif %}
                </div>
            </div>

            <!-- Seções do Perfil -->
            <div class="profile-sections">
                {% if user.is_student %}
                    <!-- Informações Acadêmicas -->
                    <div class="profile-section">
                        <h3 class="section-title">
                            <i class="fas fa-graduation-cap"></i>
                            Informações Acadêmicas
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Curso</span>
                                <span class="info-value">{{ user.course|default:"Não informado" }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Período</span>
                                <span class="info-value">{{ user.semester|default:"Não informado" }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Universidade</span>
                                <span class="info-value">{{ user.university|default:"Não informada" }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Habilidades -->
                    <div class="profile-section">
                        <h3 class="section-title">
                            <i class="fas fa-star"></i>
                            Habilidades
                        </h3>
                        <div class="tags-container">
                            {% if user.skills %}
                                {% for skill in user.skills_list %}
                                    <span class="tag">{{ skill }}</span>
                                {% endfor %}
                            {% else %}
                                <span class="tag">Python</span>
                                <span class="tag">JavaScript</span>
                                <span class="tag">React</span>
                                <span class="tag">Design</span>
                                <span class="tag">Comunicação</span>
                            {% endif %}
                        </div>
                    </div>
                {% elif user.is_company %}
                    <!-- Informações da Empresa -->
                    <div class="profile-section">
                        <h3 class="section-title">
                            <i class="fas fa-building"></i>
                            Informações da Empresa
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Área de Atuação</span>
                                <span class="info-value">{{ user.company_area|default:"Não informada" }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Localização</span>
                                <span class="info-value">{{ user.company_location|default:"Não informada" }}</span>
                            </div>
                            {% if user.company_website %}
                                <div class="info-item">
                                    <span class="info-label">Website</span>
                                    <a href="{{ user.company_website }}" class="social-link" target="_blank">
                                        <i class="fas fa-external-link-alt"></i>
                                        Visitar Site
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Estatísticas -->
                    <div class="profile-section">
                        <h3 class="section-title">
                            <i class="fas fa-chart-bar"></i>
                            Estatísticas
                        </h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Vagas Publicadas</span>
                                <span class="info-value">{{ user.joblisting_set.count|default:"0" }}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Stories Criados</span>
                                <span class="info-value">{{ user.story_set.count|default:"0" }}</span>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function changeBannerColor(gradient) {
    const banner = document.getElementById('profile-banner');
    
    // Remove todas as classes de gradiente
    banner.classList.remove('gradient1', 'gradient2', 'gradient3', 'gradient4', 'gradient5');
    
    // Aplica o novo gradiente baseado na classe
    const gradients = {
        'gradient1': 'linear-gradient(135deg, #E1306C, #F56040, #405DE6)',
        'gradient2': 'linear-gradient(135deg, #667eea, #764ba2)',
        'gradient3': 'linear-gradient(135deg, #f093fb, #f5576c)',
        'gradient4': 'linear-gradient(135deg, #4facfe, #00f2fe)',
        'gradient5': 'linear-gradient(135deg, #a8edea, #fed6e3)'
    };
    
    banner.style.background = gradients[gradient];
    
    // Salva a preferência no localStorage
    localStorage.setItem('profileBannerGradient', gradient);
}

// Carrega a preferência salva ao carregar a página
document.addEventListener('DOMContentLoaded', function() {
    const savedGradient = localStorage.getItem('profileBannerGradient');
    if (savedGradient) {
        changeBannerColor(savedGradient);
    }
});
</script>
{% endblock %}